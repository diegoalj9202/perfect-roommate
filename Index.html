<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Perfect Roommate ‚Äî B1</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#101a33;
      --card2:#0f1830;
      --text:#eef2ff;
      --muted:#c7cffc;
      --line:rgba(255,255,255,.12);
      --accent:#7dd3fc;
      --accent2:#a78bfa;
      --good:#86efac;
      --bad:#fca5a5;
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(900px 500px at 12% 8%, rgba(167,139,250,.25), transparent 55%),
                  radial-gradient(800px 520px at 78% 18%, rgba(125,211,252,.25), transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
    }

    .app{ width:min(1100px, 100%); }

    header{
      display:flex;
      gap:16px;
      flex-wrap:wrap;
      align-items:flex-end;
      justify-content:space-between;
      margin-bottom:18px;
    }

    h1{
      margin:0;
      font-size:clamp(22px, 2.8vw, 34px);
      letter-spacing:.2px;
    }

    .subtitle{
      margin:6px 0 0;
      color:var(--muted);
      max-width:70ch;
      line-height:1.35;
      font-size:14px;
    }

    .teacher-note{
      background: linear-gradient(180deg, rgba(125,211,252,.14), rgba(167,139,250,.10));
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      font-size:13px;
      color:var(--muted);
      min-width:min(420px, 100%);
    }
    .teacher-note b{color:var(--text)}

    .layout{
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:16px;
      align-items:start;
    }

    @media (max-width: 900px){
      .layout{grid-template-columns: 1fr;}
    }

    .nav{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
      position:sticky;
      top:18px;
    }

    .nav h2{
      font-size:14px;
      margin:0 0 10px;
      color:var(--muted);
      letter-spacing:.3px;
      text-transform:uppercase;
    }

    .tab-btn{
      width:100%;
      text-align:left;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:12px 12px;
      border-radius:14px;
      cursor:pointer;
      display:flex;
      gap:10px;
      align-items:center;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      margin-bottom:10px;
    }
    .tab-btn:hover{transform: translateY(-1px); background:rgba(255,255,255,.07)}
    .tab-btn[aria-selected="true"]{
      border-color: rgba(125,211,252,.6);
      background: linear-gradient(90deg, rgba(125,211,252,.20), rgba(167,139,250,.10));
    }

    .badge{
      width:34px;
      height:34px;
      border-radius:12px;
      display:grid;
      place-items:center;
      font-weight:800;
      letter-spacing:.3px;
      box-shadow: 0 10px 26px rgba(0,0,0,.3);
      border:1px solid rgba(255,255,255,.18);
      flex:0 0 auto;
    }
    .badge.home{background: rgba(251,191,36,.18); color:#fff7d6;}
    .badge.a{background: rgba(125,211,252,.22); color:#dff6ff;}
    .badge.b{background: rgba(167,139,250,.22); color:#f1eaff;}
    .badge.c{background: rgba(134,239,172,.18); color:#eafff1;}
    .badge.v{background: rgba(252,165,165,.16); color:#fff1f1;}

    .btn-text{display:flex; flex-direction:column; gap:2px;}
    .btn-text .name{font-weight:700;}
    .btn-text .tag{font-size:12px; color:var(--muted)}

    .help{
      margin-top:12px;
      padding-top:12px;
      border-top:1px solid var(--line);
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
    }

    .help .question{
      display:block;
      margin-top:10px;
      padding:10px;
      border-radius:12px;
      border:1px dashed rgba(255,255,255,.20);
      background: rgba(0,0,0,.12);
      color:var(--muted);
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
      overflow:hidden;
    }

    .hero{
      display:flex;
      gap:16px;
      align-items:stretch;
      flex-wrap:wrap;
    }

    .photo{
      width:180px;
      height:180px;
      border-radius:22px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.14);
      position:relative;
      overflow:hidden;
      padding:0;
      flex:0 0 auto;
    }
    .photo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .bio{
      flex:1 1 320px;
      min-width:260px;
    }

    .topline{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
    }

    .topline h2{
      margin:0;
      font-size:26px;
      letter-spacing:.2px;
    }

    .pill{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.05);
      color:var(--muted);
      font-size:12px;
      display:inline-flex;
      gap:8px;
      align-items:center;
      white-space:nowrap;
    }

    .pill .dot{width:8px; height:8px; border-radius:50%; background: var(--accent); opacity:.9;}

    .meta{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px;
      margin-top:10px;
    }

    .meta .box{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius:14px;
      padding:10px 12px;
      color:var(--muted);
      font-size:13px;
      line-height:1.3;
    }
    .meta .box b{color:var(--text)}

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      margin-top:16px;
    }

    @media (max-width: 700px){
      .grid{grid-template-columns: 1fr;}
    }

    .section{
      border:1px solid var(--line);
      background: rgba(0,0,0,.10);
      border-radius:16px;
      padding:12px;
    }

    .section h3{
      margin:0 0 10px;
      font-size:14px;
      letter-spacing:.25px;
      text-transform:uppercase;
      color:var(--muted);
    }

    ul{margin:0; padding-left:18px; color:var(--text); line-height:1.4;}
    li{margin:6px 0;}

    .good h3{color: rgba(134,239,172,.95)}
    .bad h3{color: rgba(252,165,165,.95)}

    .quote{
      margin-top:14px;
      padding:12px;
      border-radius:16px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      color:var(--text);
    }

    .quote p{margin:0; font-size:15px; line-height:1.4;}
    .quote .mark{font-weight:900; margin-right:6px; opacity:.9;}

    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:14px;
    }

    .control{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      font-size:13px;
    }

    .checkbox{
      display:flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
    }
    .checkbox input{width:18px; height:18px; accent-color: var(--accent);}

    .footer{
      margin-top:14px;
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
      border-top:1px solid var(--line);
      padding-top:12px;
    }

    .compare{
      display:none;
      margin-top:14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.10);
      border-radius:16px;
      padding:12px;
    }

    .compare h3{margin:0 0 10px; color:var(--muted); font-size:14px; text-transform:uppercase; letter-spacing:.25px;}

    .compare .row{
      display:grid;
      grid-template-columns: 120px 1fr;
      gap:10px;
      padding:8px 0;
      border-top:1px solid rgba(255,255,255,.08);
    }
    .compare .row:first-of-type{border-top:none; padding-top:0;}

    .label-sm{color:var(--muted); font-weight:700; font-size:13px;}

    .note{
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
    }

    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12px;
      padding:2px 6px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.05);
      color:var(--text);
    }

    /* Tabs */
    .panel{ display:none; }
    .panel.active{ display:block; }

    /* Scenario (Home) */
    .scenario .headline{
      font-size:22px;
      font-weight:800;
      margin:0 0 12px;
      letter-spacing:.2px;
    }
    .scenario .box{
      border:1px solid var(--line);
      background: rgba(0,0,0,.10);
      border-radius:16px;
      padding:12px;
      margin-top:12px;
    }
    .scenario .box h3{
      margin:0 0 8px;
      font-size:14px;
      text-transform:uppercase;
      letter-spacing:.25px;
      color:var(--muted);
    }
    .scenario p{margin:0; color:var(--text); line-height:1.45;}
    .scenario .rule{
      border-left:4px solid rgba(252,165,165,.9);
      padding-left:10px;
    }
    .scenario .start{ margin-top:14px; }
    .start button{
      border:1px solid rgba(125,211,252,.6);
      background: linear-gradient(90deg, rgba(125,211,252,.22), rgba(167,139,250,.12));
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:700;
    }
    .start button:hover{background:rgba(255,255,255,.07)}

    /* Verdict panel */
    .verdict h2{margin:0 0 8px; font-size:24px;}
    .verdict .hint{
      color:var(--muted);
      font-size:14px;
      line-height:1.35;
      margin:0 0 12px;
    }
    .verdict .form-row{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:12px;
    }
    .verdict select{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      font-size:14px;
      outline:none;
      min-width:260px;
    }
    .verdict .preview{
      display:flex;
      gap:12px;
      align-items:center;
      border:1px solid var(--line);
      background: rgba(0,0,0,.10);
      border-radius:16px;
      padding:12px;
      margin-top:12px;
    }
    .verdict .preview .mini{
      width:64px; height:64px;
      border-radius:16px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.14);
      flex:0 0 auto;
    }
    .verdict .preview .mini img{width:100%; height:100%; object-fit:cover; display:block;}
    .verdict .preview .who{
      display:flex; flex-direction:column; gap:2px;
    }
    .verdict .preview .who .name{font-weight:800;}
    .verdict .preview .who .tag{color:var(--muted); font-size:13px;}
    .verdict textarea{
      width:100%;
      min-height:170px;
      resize:vertical;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--text);
      padding:12px;
      border-radius:16px;
      font-size:15px;
      line-height:1.45;
      outline:none;
      margin-top:12px;
    }
    .verdict .counter{
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-top:10px;
      color:var(--muted);
      font-size:13px;
    }
    .verdict .counter b{color:var(--text)}
    .verdict .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .btn{
      border:1px solid rgba(125,211,252,.6);
      background: linear-gradient(90deg, rgba(125,211,252,.22), rgba(167,139,250,.12));
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:800;
      font-size:14px;
    }
    .btn:hover{background:rgba(255,255,255,.07)}
    .btn.secondary{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      font-weight:700;
    }
    .verdict .smallnote{
      margin-top:10px;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
    }

    /* In-page fallback preview (if download is blocked) */
    .download-preview{
      margin-top:12px;
      border:1px dashed rgba(255,255,255,.22);
      background: rgba(0,0,0,.10);
      border-radius:16px;
      padding:12px;
      display:none;
    }
    .download-preview .title{
      font-weight:800;
      margin:0 0 8px;
    }
    .download-preview img{
      width:100%;
      max-width:900px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      display:block;
    }
    .download-preview .tip{
      color:var(--muted);
      font-size:13px;
      margin-top:8px;
      line-height:1.35;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>The Perfect Roommate</h1>
        <p class="subtitle">Read the scenario first. Then explore the candidate profile cards and argue who is the best roommate for <b>you</b> (or for a situation your teacher gives you).</p>
      </div>
      <div class="teacher-note">
        <b>Teacher tip:</b> Think about the things you consider are on favor of the candidate you choose. You must be ready to convince others using <b>reasons</b> and <b>examples</b>.
        <div style="margin-top:6px;">Useful phrases: <i>In my opinion‚Ä¶ / I prefer‚Ä¶ / That could be a problem because‚Ä¶ / On the other hand‚Ä¶</i></div>
      </div>
    </header>

    <div class="layout">
      <aside class="nav" aria-label="Navigation">
        <h2>Navigate</h2>

        <button class="tab-btn" data-tab="home" aria-selected="true">
          <div class="badge home">üè†</div>
          <div class="btn-text">
            <div class="name">Home (Scenario)</div>
            <div class="tag">Read the context first</div>
          </div>
        </button>

        <button class="tab-btn" data-tab="A" aria-selected="false">
          <div class="badge a">A</div>
          <div class="btn-text">
            <div class="name" id="navNameA">Nina Torres (28)</div>
            <div class="tag" id="navTagA">The Friendly Hurricane</div>
          </div>
        </button>

        <button class="tab-btn" data-tab="B" aria-selected="false">
          <div class="badge b">B</div>
          <div class="btn-text">
            <div class="name" id="navNameB">Daniel Park (32)</div>
            <div class="tag" id="navTagB">The Quiet Controller</div>
          </div>
        </button>

        <button class="tab-btn" data-tab="C" aria-selected="false">
          <div class="badge c">C</div>
          <div class="btn-text">
            <div class="name" id="navNameC">Leo Ramirez (26)</div>
            <div class="tag" id="navTagC">The Chill Drifter</div>
          </div>
        </button>

        <button class="tab-btn" data-tab="verdict" aria-selected="false">
          <div class="badge v">üìù</div>
          <div class="btn-text">
            <div class="name">Final Verdict</div>
            <div class="tag">Write & download</div>
          </div>
        </button>

        <div class="help">
          <div><b>How to use:</b></div>
          <div>1) Read <b>Home (Scenario)</b>.</div>
          <div>2) Click A, B, or C.</div>
          <div>3) Decide: <b>best roommate</b> for your home.</div>
          <div>4) Open <b>Final Verdict</b> and write your decision.</div>
          <span class="question">Discussion question: <b>What is your ‚Äúmust-have‚Äù rule</b> for a roommate?</span>
          <div class="note">Tip: Use <span class="kbd">Tab</span> and <span class="kbd">Enter</span> to navigate with the keyboard.</div>
        </div>
      </aside>

      <!-- HOME PANEL -->
      <main class="card panel active scenario" id="panel-home" aria-live="polite">
        <div class="headline">üåû Cozy Apartment Near the Metro needs 1 new roommate!</div>

        <div class="box">
          <h3>The Apartment</h3>
          <p>
            It‚Äôs a <b>small but bright</b> 3-bedroom apartment, 7 minutes from the metro. The best parts are a <b>nice balcony</b>
            and <b>cheap rent</b> for this area. The problem is that the building has <b>very thin walls</b>, so neighbors complain
            when there is noise at night.
          </p>
        </div>

        <div class="box">
          <h3>The ‚ÄúCurrent Roommates‚Äù (You!)</h3>
          <p>
            You are the <b>House Committee</b>. Right now, the apartment has two adults who work early mornings and one part-time student.
            You like a <b>calm home</b>: you usually study, cook simple dinners, and sleep before 11 p.m. You don‚Äôt mind friendly people,
            but you don‚Äôt want a home that feels like a party every day.
          </p>
        </div>

        <div class="box rule">
          <h3>The Deal Breaker Rule</h3>
          <p>
            <b>No pets allowed.</b> The landlord is strict, and the neighbors are nervous about animals in the building.
          </p>
        </div>

        <div class="box">
          <h3>Your Task</h3>
          <p>
            Read the three candidates. Then choose the best new roommate for this apartment. Give <b>3 reasons</b> and <b>1 warning</b>.
          </p>
          <div class="start">
            <button id="goCandidates">Start: View Candidates</button>
          </div>
        </div>
      </main>

      <!-- CANDIDATE PANEL -->
      <main class="card panel" id="panel-candidates" aria-live="polite">
        <div class="hero">
          <div class="photo" id="photoBox">
            <img id="profilePhoto" src="" alt="Profile photo" />
          </div>

          <div class="bio">
            <div class="topline">
              <h2 id="nameAge">Nina Torres (28)</h2>
              <span class="pill" id="tagline"><span class="dot"></span> The Friendly Hurricane</span>
            </div>

            <div class="meta">
              <div class="box"><b>Job Title:</b><br><span id="jobTitle">Event assistant</span></div>
              <div class="box"><b>Style:</b><br><span id="styleHint">Social ‚Ä¢ Loud ‚Ä¢ Generous</span></div>
            </div>

            <div class="controls">
              <div class="control checkbox">
                <input id="toggleCompare" type="checkbox" />
                <label for="toggleCompare">Show quick compare table</label>
              </div>
            </div>
          </div>
        </div>

        <div class="grid">
          <section class="section good">
            <h3>Habits &amp; Lifestyle (The Good)</h3>
            <ul id="goodList"></ul>
          </section>

          <section class="section bad">
            <h3>Habits &amp; Lifestyle (The Bad)</h3>
            <ul id="badList"></ul>
          </section>
        </div>

        <div class="quote" aria-label="Direct quote">
          <p><span class="mark">‚Äú</span><span id="quoteText">Don‚Äôt worry, I‚Äôll share my food‚Äîlet‚Äôs make this place feel like home!</span><span class="mark">‚Äù</span></p>
        </div>

        <section class="compare" id="compareBox">
          <h3>Quick compare</h3>
          <div class="row"><div class="label-sm">Noise</div><div id="cmpNoise">Very loud</div></div>
          <div class="row"><div class="label-sm">Cleanliness</div><div id="cmpClean">Very messy</div></div>
          <div class="row"><div class="label-sm">Visitors</div><div id="cmpVisitors">Many friends visit often</div></div>
          <div class="row"><div class="label-sm">Money</div><div id="cmpMoney">Pays on time</div></div>
          <div class="row"><div class="label-sm">Best for</div><div id="cmpBestFor">Someone who likes a busy home</div></div>
          <div class="note">Now compare: Which ‚Äúbad‚Äù point is the biggest problem for you?</div>
        </section>

        <div class="footer">
          <b>Task:</b> Choose the best roommate. Give <b>3 reasons</b> and <b>1 warning</b>.
        </div>
      </main>

      <!-- VERDICT PANEL -->
      <main class="card panel verdict" id="panel-verdict" aria-live="polite">
        <h2>Final Verdict</h2>
        <p class="hint">
          Choose your final roommate and write a short justification of <b>about 80 words</b>.
          Include <b>reasons</b> and at least <b>one warning</b>.
        </p>

        <div class="section">
          <h3>Choose the roommate</h3>
          <div class="form-row">
            <select id="verdictSelect" aria-label="Select candidate">
              <option value="A">Candidate A ‚Äî Nina Torres</option>
              <option value="B">Candidate B ‚Äî Daniel Park</option>
              <option value="C">Candidate C ‚Äî Leo Ramirez</option>
            </select>
            <button class="btn secondary" id="useCurrentBtn" type="button">Use the candidate I last viewed</button>
          </div>

          <div class="preview" aria-label="Selected candidate preview">
            <div class="mini"><img id="verdictPhoto" src="" alt="Selected candidate photo"></div>
            <div class="who">
              <div class="name" id="verdictName">Nina Torres (28)</div>
              <div class="tag" id="verdictTag">The Friendly Hurricane</div>
            </div>
          </div>
        </div>

        <div class="section">
          <h3>Your justification (about 80 words)</h3>
          <textarea id="verdictText" placeholder="Write your final decision here... (about 80 words)"></textarea>

          <div class="counter">
            <div>Word count: <b id="wordCount">0</b> / 80</div>
            <div id="wordTip">Tip: 70‚Äì90 words is okay.</div>
          </div>

          <div class="actions">
            <button class="btn" id="downloadVerdictBtn" type="button">Download verdict image (PNG)</button>
            <button class="btn secondary" id="clearVerdictBtn" type="button">Clear</button>
          </div>

          <div class="download-preview" id="downloadPreview">
            <div class="title">If the download is blocked:</div>
            <img id="downloadPreviewImg" alt="Verdict image preview">
            <div class="tip">
              Right-click the image and choose <b>Save image as‚Ä¶</b><br>
              (On a phone: press and hold the image ‚Üí Save / Download.)
            </div>
          </div>

          <div class="smallnote">
            Note: This works best after publishing on GitHub Pages. Some browsers restrict downloads from files opened by double-clicking.
          </div>
        </div>
      </main>

    </div>
  </div>

  <script>
    /* ---------- Canvas roundRect polyfill (prevents crashes) ---------- */
    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
        const rr = Array.isArray(r) ? r : [r, r, r, r];
        this.beginPath();
        this.moveTo(x + rr[0], y);
        this.lineTo(x + w - rr[1], y);
        this.quadraticCurveTo(x + w, y, x + w, y + rr[1]);
        this.lineTo(x + w, y + h - rr[2]);
        this.quadraticCurveTo(x + w, y + h, x + w - rr[2], y + h);
        this.lineTo(x + rr[3], y + h);
        this.quadraticCurveTo(x, y + h, x, y + h - rr[3]);
        this.lineTo(x, y + rr[0]);
        this.quadraticCurveTo(x, y, x + rr[0], y);
        this.closePath();
      };
    }

    const candidates = {
      A: {
        id: "A",
        nameAge: "Nina Torres (28)",
        jobTitle: "Event assistant",
        tagline: "The Friendly Hurricane",
        styleHint: "Social ‚Ä¢ Loud ‚Ä¢ Generous",
        good: [
          "Pays rent on time and offers to help with bills.",
          "Loves to cook and shares food with everyone.",
          "Friendly and welcoming; knows many neighbors."
        ],
        bad: [
          "Leaves clothes and bags on the floor.",
          "Plays music and talks on the phone late at night.",
          "Invites friends over without warning."
        ],
        quote: "Don‚Äôt worry, I‚Äôll share my food‚Äîlet‚Äôs make this place feel like home!",
        photo: "images/nina.jpg",
        compare: {
          noise: "Very loud",
          clean: "Very messy",
          visitors: "Many friends visit often",
          money: "Pays on time",
          bestFor: "Someone who likes a busy home"
        }
      },
      B: {
        id: "B",
        nameAge: "Daniel Park (32)",
        jobTitle: "Accountant",
        tagline: "The Quiet Controller",
        styleHint: "Organized ‚Ä¢ Serious ‚Ä¢ Quiet",
        good: [
          "Keeps the kitchen and bathroom very clean.",
          "Plans shopping and pays bills early.",
          "Respects sleep; always quiet at night."
        ],
        bad: [
          "Hates visitors and says ‚Äúno guests‚Äù most of the time.",
          "Has strict rules about shoes, noise, and cleaning.",
          "Can be cold and not very friendly."
        ],
        quote: "I like peace and order. Please follow the house rules.",
        photo: "images/daniel.jpg",
        compare: {
          noise: "Very quiet",
          clean: "Very clean",
          visitors: "Almost no visitors",
          money: "Very careful with money",
          bestFor: "Someone who needs calm and structure"
        }
      },
      C: {
        id: "C",
        nameAge: "Leo Ramirez (26)",
        jobTitle: "Between jobs (freelance sometimes)",
        tagline: "The Chill Drifter",
        styleHint: "Relaxed ‚Ä¢ Easygoing ‚Ä¢ Unreliable",
        good: [
          "Very calm and rarely gets angry.",
          "Easy to live with; does not complain much.",
          "Likes simple routines and a quiet evening."
        ],
        bad: [
          "Doesn‚Äôt have a stable job, so money is a problem.",
          "Often forgets due dates and pays late.",
          "Has a pet tarantula in a glass box (and talks to it)."
        ],
        quote: "It‚Äôll work out‚Ä¶ relax. Also, don‚Äôt worry‚ÄîSpider is friendly.",
        photo: "images/leo.jpg",
        compare: {
          noise: "Quiet to medium",
          clean: "Okay, but not perfect",
          visitors: "Few visitors",
          money: "Unreliable payments",
          bestFor: "Someone who accepts risks and wants a relaxed home"
        }
      }
    };

    // Panels
    const homePanel = document.getElementById('panel-home');
    const candidatesPanel = document.getElementById('panel-candidates');
    const verdictPanel = document.getElementById('panel-verdict');

    // Track last viewed candidate
    let lastViewedCandidateId = "A";

    // Candidate elements
    const elements = {
      nameAge: document.getElementById('nameAge'),
      jobTitle: document.getElementById('jobTitle'),
      tagline: document.getElementById('tagline'),
      styleHint: document.getElementById('styleHint'),
      goodList: document.getElementById('goodList'),
      badList: document.getElementById('badList'),
      quoteText: document.getElementById('quoteText'),
      compareBox: document.getElementById('compareBox'),
      cmpNoise: document.getElementById('cmpNoise'),
      cmpClean: document.getElementById('cmpClean'),
      cmpVisitors: document.getElementById('cmpVisitors'),
      cmpMoney: document.getElementById('cmpMoney'),
      cmpBestFor: document.getElementById('cmpBestFor'),
      toggleCompare: document.getElementById('toggleCompare'),
      profilePhoto: document.getElementById('profilePhoto')
    };

    // Verdict elements
    const v = {
      select: document.getElementById('verdictSelect'),
      photo: document.getElementById('verdictPhoto'),
      name: document.getElementById('verdictName'),
      tag: document.getElementById('verdictTag'),
      text: document.getElementById('verdictText'),
      wc: document.getElementById('wordCount'),
      tip: document.getElementById('wordTip'),
      downloadBtn: document.getElementById('downloadVerdictBtn'),
      clearBtn: document.getElementById('clearVerdictBtn'),
      useCurrentBtn: document.getElementById('useCurrentBtn'),
      previewBox: document.getElementById('downloadPreview'),
      previewImg: document.getElementById('downloadPreviewImg')
    };

    function renderList(ul, items){
      ul.innerHTML = '';
      for(const text of items){
        const li = document.createElement('li');
        li.textContent = text;
        ul.appendChild(li);
      }
    }

    function setCandidate(id){
      const c = candidates[id];
      lastViewedCandidateId = id;

      elements.nameAge.textContent = c.nameAge;
      elements.jobTitle.textContent = c.jobTitle;
      elements.tagline.innerHTML = '<span class="dot"></span> ' + c.tagline;
      elements.styleHint.textContent = c.styleHint;
      renderList(elements.goodList, c.good);
      renderList(elements.badList, c.bad);
      elements.quoteText.textContent = c.quote;

      elements.profilePhoto.src = c.photo;
      elements.profilePhoto.alt = c.nameAge + " profile photo";

      elements.cmpNoise.textContent = c.compare.noise;
      elements.cmpClean.textContent = c.compare.clean;
      elements.cmpVisitors.textContent = c.compare.visitors;
      elements.cmpMoney.textContent = c.compare.money;
      elements.cmpBestFor.textContent = c.compare.bestFor;

      elements.toggleCompare.checked = false;
      elements.compareBox.style.display = 'none';
    }

    function showPanel(which){
      homePanel.classList.remove('active');
      candidatesPanel.classList.remove('active');
      verdictPanel.classList.remove('active');

      if(which === 'home') homePanel.classList.add('active');
      if(which === 'candidates') candidatesPanel.classList.add('active');
      if(which === 'verdict') verdictPanel.classList.add('active');
    }

    function showHome(){ showPanel('home'); }
    function showCandidates(){
      showPanel('candidates');
      setCandidate(lastViewedCandidateId || 'A');
    }
    function showVerdict(){
      showPanel('verdict');
      v.select.value = lastViewedCandidateId || 'A';
      updateVerdictPreview(v.select.value);
      updateWordCount();
      v.previewBox.style.display = 'none';
    }

    // Navigation buttons
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tab = btn.dataset.tab;

        document.querySelectorAll('.tab-btn').forEach(b => b.setAttribute('aria-selected', 'false'));
        btn.setAttribute('aria-selected', 'true');

        if (tab === 'home'){
          showHome();
        } else if (tab === 'verdict'){
          showVerdict();
        } else {
          showCandidates();
          setCandidate(tab);
        }
      });
    });

    // Compare checkbox
    elements.toggleCompare.addEventListener('change', (e) => {
      elements.compareBox.style.display = e.target.checked ? 'block' : 'none';
      if (e.target.checked) {
        elements.compareBox.scrollIntoView({ behavior: 'smooth' });
      }
    });

    // Start button
    document.getElementById('goCandidates').addEventListener('click', () => {
      const firstCandidateBtn = document.querySelector('.tab-btn[data-tab="A"]');
      document.querySelectorAll('.tab-btn').forEach(b => b.setAttribute('aria-selected', 'false'));
      firstCandidateBtn.setAttribute('aria-selected', 'true');
      showCandidates();
      setCandidate('A');
    });

    // Verdict preview
    function updateVerdictPreview(id){
      const c = candidates[id];
      v.photo.src = c.photo;
      v.photo.alt = c.nameAge + " photo";
      v.name.textContent = c.nameAge;
      v.tag.textContent = c.tagline;
    }

    v.select.addEventListener('change', () => updateVerdictPreview(v.select.value));

    v.useCurrentBtn.addEventListener('click', () => {
      v.select.value = lastViewedCandidateId || 'A';
      updateVerdictPreview(v.select.value);
    });

    // Word counter
    function countWords(text){
      const cleaned = (text || "")
        .replace(/[\n\r\t]/g, " ")
        .replace(/\s+/g, " ")
        .trim();
      if(!cleaned) return 0;
      return cleaned.split(" ").filter(Boolean).length;
    }

    function updateWordCount(){
      const wc = countWords(v.text.value);
      v.wc.textContent = wc;
      if (wc < 60) v.tip.textContent = "Tip: Add more reasons and examples.";
      else if (wc <= 100) v.tip.textContent = "Good length. 70‚Äì90 words is perfect.";
      else v.tip.textContent = "Tip: Try to be shorter and clearer.";
    }

    v.text.addEventListener('input', updateWordCount);

    v.clearBtn.addEventListener('click', () => {
      v.text.value = "";
      updateWordCount();
      v.text.focus();
      v.previewBox.style.display = 'none';
    });

    // Helpers for image + wrapping
    function loadImage(src){
      return new Promise((resolve) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = () => resolve(null);
        img.src = src;
      });
    }

    function wrapLines(ctx, text, maxWidth){
      const words = (text || "").split(/\s+/).filter(Boolean);
      const lines = [];
      let line = "";
      for (const w of words){
        const test = line ? (line + " " + w) : w;
        if (ctx.measureText(test).width <= maxWidth){
          line = test;
        } else {
          if (line) lines.push(line);
          line = w;
        }
      }
      if (line) lines.push(line);
      return lines;
    }

    // Download (robust)
    v.downloadBtn.addEventListener('click', async () => {
      const chosenId = v.select.value || 'A';
      const c = candidates[chosenId];
      const text = v.text.value.trim();
      const wc = countWords(text);

      // Build canvas
      const W = 1200, H = 675;
      const canvas = document.createElement('canvas');
      canvas.width = W; canvas.height = H;
      const ctx = canvas.getContext('2d');

      // BG
      const grad = ctx.createLinearGradient(0, 0, W, H);
      grad.addColorStop(0, '#0b1220');
      grad.addColorStop(1, '#101a33');
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, W, H);

      // Card
      const pad = 48;
      const cardX = pad, cardY = pad, cardW = W - pad*2, cardH = H - pad*2;
      ctx.fillStyle = 'rgba(255,255,255,0.04)';
      ctx.strokeStyle = 'rgba(255,255,255,0.12)';
      ctx.lineWidth = 2;
      ctx.roundRect(cardX, cardY, cardW, cardH, 26);
      ctx.fill(); ctx.stroke();

      // Title
      ctx.fillStyle = '#eef2ff';
      ctx.font = '800 34px system-ui, Segoe UI, Arial';
      ctx.fillText('The Perfect Roommate ‚Äî Final Verdict', cardX + 28, cardY + 64);

      // Photo
      const imgSize = 132;
      const imgX = cardX + 28;
      const imgY = cardY + 92;

      const img = await loadImage(c.photo);
      if (img){
        ctx.save();
        ctx.roundRect(imgX, imgY, imgSize, imgSize, 22);
        ctx.clip();

        const scale = Math.max(imgSize / img.width, imgSize / img.height);
        const dw = img.width * scale;
        const dh = img.height * scale;
        const dx = imgX + (imgSize - dw)/2;
        const dy = imgY + (imgSize - dh)/2;
        ctx.drawImage(img, dx, dy, dw, dh);
        ctx.restore();

        ctx.strokeStyle = 'rgba(255,255,255,0.18)';
        ctx.lineWidth = 2;
        ctx.roundRect(imgX, imgY, imgSize, imgSize, 22);
        ctx.stroke();
      } else {
        ctx.fillStyle = 'rgba(0,0,0,0.20)';
        ctx.roundRect(imgX, imgY, imgSize, imgSize, 22);
        ctx.fill();
        ctx.strokeStyle = 'rgba(255,255,255,0.18)';
        ctx.stroke();
        ctx.fillStyle = '#c7cffc';
        ctx.font = '700 14px system-ui, Segoe UI, Arial';
        ctx.fillText('Photo not loaded', imgX + 16, imgY + 72);
      }

      // Name/tag
      ctx.fillStyle = '#eef2ff';
      ctx.font = '800 28px system-ui, Segoe UI, Arial';
      ctx.fillText(c.nameAge, imgX + imgSize + 22, imgY + 42);

      ctx.fillStyle = '#c7cffc';
      ctx.font = '700 18px system-ui, Segoe UI, Arial';
      ctx.fillText(c.tagline, imgX + imgSize + 22, imgY + 74);

      ctx.fillStyle = 'rgba(255,255,255,0.75)';
      ctx.font = '600 16px system-ui, Segoe UI, Arial';
      ctx.fillText(`Justification (${wc} words)`, imgX + imgSize + 22, imgY + 106);

      // Text box
      const boxX = cardX + 28;
      const boxY = imgY + imgSize + 24;
      const boxW = cardW - 56;
      const boxH = cardH - (boxY - cardY) - 28;

      ctx.fillStyle = 'rgba(0,0,0,0.12)';
      ctx.strokeStyle = 'rgba(255,255,255,0.12)';
      ctx.lineWidth = 2;
      ctx.roundRect(boxX, boxY, boxW, boxH, 18);
      ctx.fill(); ctx.stroke();

      // Text
      const textPad = 22;
      const maxWidth = boxW - textPad*2;
      ctx.fillStyle = '#eef2ff';
      ctx.font = '500 20px system-ui, Segoe UI, Arial';
      const content = text || "(No text written.)";
      const lines = wrapLines(ctx, content, maxWidth);
      const lineHeight = 30;
      const maxLines = Math.floor((boxH - textPad*2) / lineHeight);
      const shown = lines.slice(0, maxLines);

      let y = boxY + textPad + 28;
      for (const line of shown){
        ctx.fillText(line, boxX + textPad, y);
        y += lineHeight;
      }
      if (lines.length > maxLines){
        ctx.fillStyle = 'rgba(255,255,255,0.65)';
        ctx.font = '600 16px system-ui, Segoe UI, Arial';
        ctx.fillText('‚Ä¶(text continues)', boxX + textPad, boxY + boxH - 18);
      }

      // Convert to Blob and download
      canvas.toBlob((blob) => {
        if (!blob) {
          // If blob fails, show preview
          v.previewImg.src = canvas.toDataURL('image/png');
          v.previewBox.style.display = 'block';
          return;
        }

        const filename = `final_verdict_${chosenId}.png`;
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);

        // Try download
        a.click();

        // Cleanup
        setTimeout(() => {
          URL.revokeObjectURL(url);
          document.body.removeChild(a);
        }, 150);

        // In some locked-down browsers, download may still be blocked.
        // So we ALSO show the preview to be safe.
        v.previewImg.src = canvas.toDataURL('image/png');
        v.previewBox.style.display = 'block';
      }, 'image/png');
    });

    // Initial
    showHome();
    setCandidate('A');
    updateVerdictPreview('A');
    updateWordCount();
  </script>
</body>
</html>
